# One21 â€” Caddyfile
# Replace one21.yourdomain.com with your actual domain.
# Caddy handles SSL automatically via Let's Encrypt.
#
# Usage:
#   caddy run --config Caddyfile
#   caddy reload --config Caddyfile

one21.yourdomain.com {
    # Reverse proxy to Node.js
    reverse_proxy localhost:3737 {
        # WebSocket support (Socket.IO)
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # GZIP compression
    encode gzip

    # Security headers (supplement to helmet)
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
        -Server
    }

    # Serve uploaded files with cache headers
    @uploads path /uploads/*
    header @uploads Cache-Control "public, max-age=31536000, immutable"

    # Static assets caching
    @static path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.woff2 *.svg
    header @static Cache-Control "public, max-age=86400"

    # Logging
    log {
        output file /var/log/caddy/one21.log
        format json
    }
}
